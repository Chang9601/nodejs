const { StringDecoder } = require('string_decoder');

const stringDecoder = new StringDecoder('utf8');

// BufferëŠ” NodeJSì—ì„œ ì´ì§„ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë° ë„ì›€ì„ ì£¼ê¸° ìœ„í•´ ì¡´ì¬í•œë‹¤.
// BufferëŠ” ë©”ëª¨ë¦¬ì˜ ë©ì–´ë¦¬ì´ë©° ë°”ì´íŠ¸ ë°°ì—´ë¡œ ìƒì„± ì‹œ í¬ê¸°ë¥¼ ì„¤ì •í•˜ê³  ì´í›„ì—ëŠ” ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.
// í•˜ë‚˜ì˜ ë°”ì´íŠ¸ì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ìˆ«ìê°€ 255ì´ë‹¤. ê°’ì´ 255ë³´ë‹¤ í° ê²½ìš° 256ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë‚˜ë¨¸ì§€ê°€ ìš”ì†Œì— í• ë‹¹ëœë‹¤.
// ë°”ì´íŠ¸ì— ìŒìˆ˜ë¥¼ í• ë‹¹í•˜ë ¤ê³  í•˜ë©´ 2ì˜ ë³´ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€í™˜ëœë‹¤.
const buffer = Buffer.alloc(10);

buffer[0] = 123;
buffer[1] = 256;
buffer[2] = -20;

console.log(buffer[0]); // 123
console.log(buffer[1]); // 0 === 256 % 256
console.log(buffer[2]); // 236

// BufferëŠ” ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ë¬¸ìì—´ì˜ ê²½ìš°ë„ ì‘ë™í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ UTF-8 ì¸ì½”ë”©ì„ ì‚¬ìš©í•œí•œë‹¤.
// from() ë©”ì„œë“œì— ì „ë‹¬í•˜ëŠ” 2ë²ˆ ì¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì½”ë”©ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ì½ê¸°ì˜ ê²½ìš° toString() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ ì½ì„ ìˆ˜ ìˆë‹¤.
const lunch = Buffer.from('ì˜¤ëŠ˜ ì ì‹¬ì€ ë¼ì§€êµ­ë°¥!');
console.log(lunch.toString());

// Buffer ì‚¬ìš© ì‹œ UTF-8 ë¬¸ì ì¤‘ì—ëŠ” í•˜ë‚˜ì˜ ë°”ì´íŠ¸ë§Œìœ¼ë¡œ í‘œí˜„ë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ì•„ì„œ ì´ë¡œ ì¸í•´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
// ì˜ˆë¥¼ ë“¤ì–´, ê¸´ í…ìŠ¤íŠ¸ íŒŒì¼ì„ í•´ì„í•  ë•Œ ë©ì–´ë¦¬(chunk)ë¡œ êµ¬ë¬¸ì„ ë¶„ì„í•˜ëŠ” ê²½ìš° í•˜ë‚˜ì˜ ë©ì–´ë¦¬ì— ë¬¸ìì˜ ì¼ë¶€ë§Œ í¬í•¨ë  ìˆ˜ ìˆë‹¤. ì°¸ê³ ë¡œ, ê° ë²„í¼ëŠ” ë³„ë„ë¡œ ì²˜ë¦¬ëœë‹¤.
// ì´ ê²½ìš° StringDecoderë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤. StringDecoderëŠ” Buffer ê°ì²´ë¥¼ ë¬¸ìì—´ë¡œ ë³µí˜¸í™”í•˜ëŠ” APIë¥¼ ì œê³µí•˜ëŠ” ë™ì‹œì— ë‹¤ì¤‘ë°”ì´íŠ¸ ë¬¸ìë¥¼ ë³´ì¡´í•œë‹¤.
const music = [
  Buffer.from('Zack Hemseyì˜ ëª…ê³¡!'),
  Buffer.from('The Way'),
  Buffer.from([0b11110000, 0b10011111, 0b10100100, 0b10011001]),
];

const result1 = music.reduce(
  (total, piece) => `${total.toString() + piece.toString()}`
);

console.log(result1); // Zack Hemseyì˜ ëª…ê³¡!The Way???

const result2 = music.reduce(
  (total, piece) => `${total}${stringDecoder.write(piece)}`,
  ''
);

console.log(result2); // Zack Hemseyì˜ ëª…ê³¡!The WayğŸ¤™
